


'use strict';

var Orchestrator=require('../'),
should=require('should');
require('mocha'),

describe('orchestrator',function(){
describe('_runTask() task timings',function(){

it('should set duration to 1 when task takes 1 second',function(done){
var orchestrator,a,fn,timeout;


timeout=0.01,
a=0,
fn=function(cb){
setTimeout(function(){
cb();
},1e3*timeout);
},


orchestrator=new Orchestrator,
orchestrator.add('test',fn),

orchestrator.on('task_stop',function(args){

args.duration.should.be.approximately(timeout,0.02),
args.duration.should.be.above(0),
++a;
}),


orchestrator.start('test',function(err){

a.should.equal(1),
should.not.exist(err),
done();
});
});

});
});