


'use strict';

var Orchestrator=require('../'),
should=require('should');
require('mocha'),

describe('orchestrator',function(){
describe('_emitTaskDone()',function(){

it('should emit task_stop if no err',function(done){
var orchestrator,taskName,task,message,err;


taskName='test',
message='test message',
task={
name:taskName,
fn:function(){}},




orchestrator=new Orchestrator,

orchestrator.on('task_stop',function(){

done();
}),


orchestrator._emitTaskDone(task,message,err);
}),

it('should emit task_err if err',function(done){
var orchestrator,taskName,task,message,err;


taskName='test',
message='test message',
task={
name:taskName,
fn:function(){}},

err='the error',


orchestrator=new Orchestrator,

orchestrator.on('task_err',function(){

done();
}),


orchestrator._emitTaskDone(task,message,err);
}),

it('should pass task, message, duration',function(done){
var orchestrator,taskName,task,message,duration,err;


taskName='test',
message='test message',
duration=1.1,
task={
name:taskName,
fn:function(){},
duration:duration},




orchestrator=new Orchestrator,

orchestrator.on('task_stop',function(args){

args.task.should.equal(taskName),
args.duration.should.equal(duration),
args.message.should.equal(taskName+' '+message),
done();
}),


orchestrator._emitTaskDone(task,message,err);
}),

it('should pass err',function(done){
var orchestrator,taskName,task,message,err;


taskName='test',
message='test message',
task={
name:taskName,
fn:function(){}},

err='the error',


orchestrator=new Orchestrator,

orchestrator.on('task_err',function(args){

args.err.should.equal(err),
done();
}),


orchestrator._emitTaskDone(task,message,err);
}),

it('should die if no task passed',function(done){

var orchestrator=new Orchestrator,
succeed=!1;


try{
orchestrator._emitTaskDone(),
succeed=!0;
}catch(err){
succeed=!1;
}


succeed.should.equal(!1),
done();
});

});
});